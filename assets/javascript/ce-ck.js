/*

==== Dragon Drop: a demo of precise DnD
          in, around, and between 
       multiple contenteditable's.

==== Copyright 2013 Chase Moskal
  this document is free to learn from.
  http://jsfiddle.net/ChaseMoskal/T2zHQ/
*/$(document).ready(function(){function e(e){var t=this;t.$draggables=null;t.$dropzones=null;t.$noDrags=null;t.dropLoad=null;t.engage=function(e){t.$draggables=$(e.draggables);t.$dropzones=$(e.dropzones);t.$draggables.attr("draggable","true");t.$noDrags=e.noDrags?$(e.noDrags):$();t.$dropzones.attr("dropzone","copy");t.bindDraggables();t.bindDropzones()};t.bindDraggables=function(){t.$draggables=$(t.$draggables.selector);t.$noDrags=$(t.$noDrags.selector);t.$noDrags.attr("draggable","false");t.$draggables.off("dragstart").on("dragstart",function(e){var n=e.originalEvent;$(n.target).removeAttr("dragged");var r=n.dataTransfer,i=n.target.outerHTML,s=t.$draggables.is(n.target);if(s){r.effectAllowed="copy";r.setData("text/plain"," ");t.dropLoad=i;$(n.target).attr("dragged","dragged")}})};t.bindDropzones=function(){t.$dropzones=$(t.$dropzones.selector);t.$dropzones.off("dragleave").on("dragleave",function(e){var n=e.originalEvent,r=n.dataTransfer,i=t.$dropzones.is(n.relatedTarget),s=t.$dropzones.has(n.relatedTarget).length>0,o=i||s;if(!o){r.dropEffect="none";r.effectAllowed="null"}});t.$dropzones.off("drop").on("drop",function(e){var n=e.originalEvent;if(!t.dropLoad)return!1;var r=null;if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(n.clientX,n.clientY);else if(n.rangeParent){r=document.createRange();r.setStart(n.rangeParent,n.rangeOffset)}var i=window.getSelection();i.removeAllRanges();i.addRange(r);$(i.anchorNode).closest(t.$dropzones.selector).get(0).focus();document.execCommand("insertHTML",!1,'<param name="dragonDropMarker" />'+t.dropLoad);i.removeAllRanges();var s=$('param[name="dragonDropMarker"]'),o=s.length>0;if(o){$(t.$draggables.selector).filter("[dragged]").remove();s.remove()}t.dropLoad=null;t.bindDraggables();n.preventDefault()})};t.disengage=function(){t.$draggables=$(t.$draggables.selector);t.$dropzones=$(t.$dropzones.selector);t.$noDrags=$(t.$noDrags.selector);t.$draggables.removeAttr("draggable").removeAttr("dragged").off("dragstart");t.$noDrags.removeAttr("draggable");t.$dropzones.removeAttr("droppable").off("dragenter");t.$dropzones.off("drop")};e&&t.engage(e)}$(function(){window.DragonDrop=new e({draggables:$("li.imgdrag"),dropzones:$("[contenteditable]"),noDrags:$(".fancy img")});$('button[name="toggleContentEditable"]').click(function(){var e=this;$("[contenteditable]").each(function(){if($(this).attr("contenteditable")==="true"){$(this).attr("contenteditable","false");$(e).html("enable contenteditable")}else{$(this).attr("contenteditable","true");$(e).html("disable contenteditable")}})})})});